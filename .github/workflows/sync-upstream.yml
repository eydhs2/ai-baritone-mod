name: åŒæ­¥ä¸Šæ¸¸æ›´æ–°

on:
  schedule:
    - cron: '0 */6 * * *'  # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:        # æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    name: åŒæ­¥ä¸Šæ¸¸ä»“åº“
    runs-on: ubuntu-latest
    # åªåœ¨ fork çš„ä»“åº“ä¸­è¿è¡Œï¼ˆä¸æ˜¯åŽŸä»“åº“ï¼‰
    if: github.repository_owner != 'Eydhs2'
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: æ·»åŠ ä¸Šæ¸¸ä»“åº“
        run: |
          git remote add upstream https://github.com/Eydhs2/ai-baritone-mod.git
          git fetch upstream
      
      - name: é…ç½® Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: åŒæ­¥ä¸»åˆ†æ”¯
        run: |
          git checkout main
          git merge upstream/main --no-edit --allow-unrelated-histories
          git push origin main
      
      - name: åŒæ­¥å¼€å‘åˆ†æ”¯
        run: |
          git checkout dev || git checkout -b dev upstream/dev
          git merge upstream/dev --no-edit --allow-unrelated-histories || true
          git push origin dev
      
      - name: åˆ›å»ºåŒæ­¥æŠ¥å‘Š
        if: always()
        run: |
          echo "## ðŸ”„ Fork åŒæ­¥çŠ¶æ€" > $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| åˆ†æ”¯ | çŠ¶æ€ |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|" >> $GITHUB_STEP_SUMMARY
          echo "| main | âœ… å·²åŒæ­¥ |" >> $GITHUB_STEP_SUMMARY
          echo "| dev  | âœ… å·²åŒæ­¥ |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ä¸Šæ¸¸ä»“åº“: Eydhs2/ai-baritone-mod" >> $GITHUB_STEP_SUMMARY
          echo "åŒæ­¥æ—¶é—´: $(date)" >> $GITHUB_STEP_SUMMARY
